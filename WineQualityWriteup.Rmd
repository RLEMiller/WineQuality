---
title: "Wine Quality Prediction from Physiochemical Properties"
author: "Rebecca L.E. Miller"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    keep_tex: yes
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE, echo=FALSE}
if(!require(tinytex)) install.packages("tinytex", repos = "http://cran.us.r-project.org")
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(caret)) install.packages("caret", repos = "http://cran.us.r-project.org")
if(!require(data.table)) install.packages("data.table", repos = "http://cran.us.r-project.org")
if(!require(knitr)) install.packages("knitr", repos = "https://cran.us.r-project.org")
if(!require(GGally)) install.packages("GGally", repos = "http://cran.us.r-project.org")
if(!require(corrplot)) install.packages("corrplot", repos = "http://cran.us.r-project.org")

library(knitr)
library(tinytex)
library(tidyverse)
library(caret)
library(data.table)
library(GGally)
library(corrplot)

# don't show messages for tidy summarize() calls
options(dplyr.summarise.inform = FALSE) 

# set the defaults for chunk options
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, error = FALSE)
```

# Summary

# Introduction

The data used in this analysis is from the University of California Irvine Machine Learning Repository, data set number 1341136, or the Wine Quality data set from "Modeling Wine Preferences by Data Mining from Physiochemical Properties." \footnote{P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. Modeling wine preferences by data mining from physicochemical properties. In Decision Support Systems, Elsevier, 47(4):547-553, 2009.} The data consists of eleven physiochemical properties and a quality score between 0 and 10 for each wine in the set. There are two subsets, both for Portuguese "vinho verde" wines, one for red wine and one for white wine. The most obvious machine learning task for this dataset is to use the physiochemical data as predictors and the quality score as the response variable, or in more direct language, to use the physiochemical properties to predict quality.

## Download Data
The data set is available in two *.csv files found at [red](https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv)
and [white](https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-white.csv). The files can be downloaded with the following code.

```{r DownloadFiles, echo=TRUE, message=FALSE}
  ###-----------------------------------------------------------
  ###     Download And Parse Files From Remote Repository
  ###----------------------------------------------------------
  # create a temporary file in the local filesystem for download of raw csv
  dl <- tempfile()
  
  # download the file
  download.file("https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv", dl)
  
  # read the red wine quality file into a data frame
  red <- read.csv(file = dl, header = TRUE, sep = ";")
  
  # remove the dl file handle
  rm(dl)
  
  #--------------------- White Wine File ---------------------
  # make a new temp file
  dl1 <- tempfile()
  
  # Download raw csv
  download.file("https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-white.csv", dl1)
  
  # read the white wine quality file into a data frame
  white <- read.csv(file = dl1, header = TRUE, sep = ";")
  
  rm(dl1)
```

## Data Exploration
The physiochemical properties, or columns of the data sets, for the wines in the two files are
```{r echo=TRUE, message=FALSE }
  union(colnames(red), colnames(white))
```

Both files have the same physiochemical property columns
```{r echo=TRUE, message=FALSE}
  setdiff(colnames(red),colnames(white))
```

Neither data set contains `NA` values.
```{r}
  sum(is.na(red))
  sum(is.na(white))
```
Now that we have a basic understanding of the structures of the two data sets, we can combine them into a single data set. We can try to predict wine quality based on the physiochemical properties and the wine color category that we create when we join the two data sets.  We also will designate a hold-out subset and a test subset that we will use to develop the model. 

```{r catRedWhite, message=FALSE, warning=FALSE}
  # make new columns for the wine color or type
  red <- red %>% mutate(red = 1)
  white <- white %>% mutate(red = 0)
  
  # combine the two data frames into one
  wines <- red %>% full_join(., white)
  
  # set the seed for reproducibility, user set.seed(1234) for R 3.5 or earlier
  set.seed(1234, sample.kind="Rounding") 
  
  # use createDataPartition as in the Data Science course material
  # set aside 10% of the data as a final test set, which we call hold_out
  test_index <- createDataPartition(y = wines$quality, times = 1, 
                                    p = 0.1, list = FALSE)
  full_train <- wines[-test_index, ]
  hold_out <- wines[test_index, ]
  
  # partition the data a second time to create test and train sets from the 
  # full_train set
  set.seed(1234, sample.kind="Rounding") 
  test_index2 <- createDataPartition(y = full_train$quality, times = 1, 
                                    p = 0.1, list = FALSE)
  train <- full_train[-test_index2, ]
  test <- full_train[test_index2, ]
                        
```

```{r correlationPlot, fig.cap="Plot of intercorrelation in the train set."}
  # Make a correlation plot of the train set
  corrplot(cor(train), order = "AOE", tl.col = "black")
```
We can also look at histograms of our variables in the `train` set to get some idea of the character of the data.

```{r histograms, message=FALSE, warning=FALSE, fig.cap="Histograms of all the variables in the train set with the exception of the type variable that we created to keep track of white/red status."}
  train %>%
    select(-red) %>%
    gather() %>%
    ggplot(aes(value)) +
      facet_wrap(~key, scales = "free", ncol = 3) +
      geom_histogram()
```

We see that quality is approximately normally distributed

# Methods

# Results

# Conclusion